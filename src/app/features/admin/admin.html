<div class="container py-4">
  <h2 class="mb-3">Internship Office</h2>
  <ul class="nav nav-tabs mb-3">
    <li class="nav-item"><button class="nav-link" [class.active]="currentTab==='students'" (click)="selectTab('students')">Students</button></li>
    <li class="nav-item"><button class="nav-link" [class.active]="currentTab==='applications'" (click)="selectTab('applications')">Applications</button></li>
    <li class="nav-item"><button class="nav-link" [class.active]="currentTab==='requests'" (click)="selectTab('requests')">Requests</button></li>
    <li class="nav-item"><button class="nav-link" [class.active]="currentTab==='announcements'" (click)="selectTab('announcements')">Announcements</button></li>
    <li class="nav-item"><button class="nav-link" [class.active]="currentTab==='officers'" (click)="selectTab('officers')">Officers</button></li>
    <li class="nav-item"><button class="nav-link" [class.active]="currentTab==='faculty'" (click)="selectTab('faculty')">Faculty</button></li>
    <li class="nav-item"><button class="nav-link" [class.active]="currentTab==='companies'" (click)="selectTab('companies')">Companies & Site</button></li>
    <li class="nav-item"><button class="nav-link" [class.active]="currentTab==='compliance'" (click)="selectTab('compliance')">Log Compliance</button></li>
    <li class="nav-item"><button class="nav-link" [class.active]="currentTab==='complaints'" (click)="selectTab('complaints')">Complaints</button></li>
    <li class="nav-item"><button class="nav-link" [class.active]="currentTab==='scheme'" (click)="selectTab('scheme')">Scheme</button></li>
  </ul>

  <div class="row g-3 mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-light">Responsibilities</div>
        <div class="card-body">
          <ul class="mb-0">
            <li>Identify potential host organizations and establish collaborations (MoUs).</li>
            <li>Arrange internship placements for students based on availability and suitability.</li>
            <li>Maintain a complete database of all internship records (placements, evaluations, reports).</li>
            <li>Assign supervisory roles: a faculty supervisor and a site/host supervisor.</li>
            <li>Organize on-campus internship expos and employer meetups with the Industry Liaison Cell.</li>
            <li>Process and respond to feedback and complaints from students, faculty, and host supervisors.</li>
            <li>Support technical infrastructure:
              <ul>
                <li>Assist students with Git/GitHub for version control and portfolios.</li>
                <li>Guide the use of Jira/Trello for project tracking and collaboration.</li>
              </ul>
            </li>
            <li>Collaborate with the Alumni Office to enhance access to opportunities via referrals and networks.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- hidden usage to ensure standalone imports are recognized -->
  <ng-template #__ensureImportsAdmin>
    {{ ([] | paginate: 1 : 10).length }}
    <app-paginator [total]="0" [page]="1" [pageSize]="10"></app-paginator>
  </ng-template>

  <div class="table-responsive" *ngIf="currentTab==='students'">
    <table class="table table-striped align-middle">
      <thead>
        <tr>
          <th>Name</th><th>Email</th><th>Approved</th><th>Faculty</th><th>Site</th><th>Company</th><th>Office Marks</th><th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let s of (students() | paginate: page.students : pageSize)">
          <td>{{ s.name }}</td>
          <td>{{ s.email }}</td>
          <td>
            <span class="badge" [class.text-bg-success]="s.approved" [class.text-bg-secondary]="!s.approved">{{ s.approved ? 'Yes' : 'No' }}</span>
          </td>
          <td>{{ s.facultyId ? facultyName(s.facultyId) : '-' }}</td>
          <td>{{ siteSupervisorName(s.siteId) }}</td>
          <td>{{ companyName(s.companyId) }}</td>
          <td style="min-width:240px">
            <div class="d-flex gap-2">
              <input type="number" class="form-control form-control-sm" [ngModel]="s.marks?.adminProposal ?? ''" (ngModelChange)="setAdminSubMarks(s.id, $event, s.marks?.adminLogs || 0, s.marks?.adminFinal || 0)" min="0" max="5" placeholder="Proposal /5" />
              <input type="number" class="form-control form-control-sm" [ngModel]="s.marks?.adminLogs ?? ''" (ngModelChange)="setAdminSubMarks(s.id, s.marks?.adminProposal || 0, $event, s.marks?.adminFinal || 0)" min="0" max="5" placeholder="Logs /5" />
              <input type="number" class="form-control form-control-sm" [ngModel]="s.marks?.adminFinal ?? ''" (ngModelChange)="setAdminSubMarks(s.id, s.marks?.adminProposal || 0, s.marks?.adminLogs || 0, $event)" min="0" max="10" placeholder="Final /10" />
            </div>
            <small class="text-muted">Auto total: {{ s.marks?.admin ?? 0 }}/20</small>
          </td>
          <td style="width:600px">
            <button class="btn btn-sm btn-outline-success me-2" (click)="approve(s.id)" [disabled]="s.approved">Approve</button>
            <div class="d-inline-flex gap-2 align-items-center">
              <select class="form-select form-select-sm" [(ngModel)]="facultyId" style="width:160px">
                <option [ngValue]="''">Faculty...</option>
                <option *ngFor="let f of facultyList()" [ngValue]="f.id">{{ f.name }} ({{ f.email }})</option>
              </select>
              <select class="form-select form-select-sm" [(ngModel)]="siteId" style="width:160px">
                <option [ngValue]="''">Site...</option>
                <option *ngFor="let t of siteList()" [ngValue]="t.id">{{ t.name }} ({{ t.email }})</option>
              </select>
              <select class="form-select form-select-sm" [(ngModel)]="companyForStudent[s.id]" style="width:160px">
                <option [ngValue]="''">Company...</option>
                <option *ngFor="let c of companyList()" [ngValue]="c.id">{{ c.name }}</option>
              </select>
              <button class="btn btn-sm btn-primary" (click)="assign(s.id)">Assign</button>
              <button class="btn btn-sm btn-outline-primary" (click)="assignCompanyToStudent(s.id)">Set Company</button>
              <button class="btn btn-sm btn-outline-secondary" (click)="viewDetails(s.id)">Details</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <app-paginator [total]="students().length" [(page)]="page.students" [pageSize]="pageSize"></app-paginator>
  </div>

  <!-- Student Details Drawer -->
  @if (selectedId; as sid) { @if (currentTab==='students') {
  <div class="card mt-3">
    <div class="card-header bg-light">Student Details</div>
    <div class="card-body">
      <div class="row g-3 mb-2">
        <div class="col-12"><strong>Student:</strong> {{ studentName(sid) }}</div>
      </div>
      <div class="row g-3">
        <div class="col-12 col-lg-6">
          <h6>Approval Forms</h6>
          <ul class="list-group mb-3">
            @for (a of approvalsOf(sid); track $index; let i = $index) {
            <li class="list-group-item">
              <details>
                <summary class="d-flex flex-wrap gap-2 align-items-baseline">
                  <span class="fw-semibold">v{{ a.version || (i+1) }}</span>
                  <span class="text-muted">— {{ a.createdAt | date:'short' }}</span>
                  <span>• Status: {{ a.status || 'pending' }}</span>
                  <span class="text-muted">• Company: {{ a.company.name || '-' }}</span>
                  <span class="text-muted">• {{ a.internship.startDate }} → {{ a.internship.endDate }}</span>
                </summary>
                <div class="mt-2">
                  <div class="row g-2">
                    <div class="col-12 col-md-6">
                      <div class="fw-semibold mb-1">Student Info</div>
                      <div class="small">Name: {{ a.studentInfo.name }}</div>
                      <div class="small">Program: {{ a.studentInfo.program }} · Semester: {{ a.studentInfo.semester }}</div>
                      <div class="small text-muted">Student ID: {{ a.studentInfo.studentId }}</div>
                    </div>
                    <div class="col-12 col-md-6">
                      <div class="fw-semibold mb-1">Company</div>
                      <div class="small">Name: {{ a.company.name }}</div>
                      <div class="small">Address: {{ a.company.address }}</div>
                      <div class="small">Supervisor: {{ a.company.supervisorName }} ({{ a.company.supervisorEmail }} · {{ a.company.supervisorPhone }})</div>
                    </div>
                  </div>
                  <hr class="my-2" />
                  <div class="row g-2">
                    <div class="col-12 col-md-6">
                      <div class="fw-semibold mb-1">Internship</div>
                      <div class="small">Dates: {{ a.internship.startDate }} → {{ a.internship.endDate }}</div>
                      <div class="small">Hours/Week: {{ a.internship.hoursPerWeek }} · Paid: {{ a.internship.paid }}</div>
                    </div>
                    <div class="col-12 col-md-6">
                      <div class="fw-semibold mb-1">Objectives & Outcomes</div>
                      <div class="small"><strong>Objectives:</strong> {{ a.objectives }}</div>
                      <div class="small"><strong>Outcomes:</strong> {{ a.outcomes }}</div>
                    </div>
                  </div>
                  @if (a.officerComment) {
                  <div class="mt-2 small"><strong>Officer Comment:</strong> <em>{{ a.officerComment }}</em></div>
                  }
                  @if (a.resolvedAt) {
                  <div class="mt-1 small text-muted">Resolved: {{ a.resolvedAt | date:'short' }}</div>
                  }
                </div>
              </details>
            </li>
            }
          </ul>

          <h6>Agreement (latest)</h6>
          @if (agreementsOf(sid); as agrs) {
            @if (agrs.length) {
              <div class="small">
                <div class="fw-semibold">Declarations</div>
                <ul class="small mb-2">
                  <li>Policy Acknowledgement: {{ agrs[agrs.length-1].policyAcknowledgement ? 'Yes' : 'No' }}</li>
                  <li>Confidentiality Agreement: {{ agrs[agrs.length-1].confidentialityAgreement ? 'Yes' : 'No' }}</li>
                  <li>Safety Training: {{ agrs[agrs.length-1].safetyTraining ? 'Yes' : 'No' }}</li>
                </ul>
                <div class="fw-semibold">Signatures</div>
                <div>Student: {{ agrs[agrs.length-1].studentSignatureName }} <span class="text-muted">— {{ agrs[agrs.length-1].date }}</span></div>
                <div>Faculty: {{ agrs[agrs.length-1].facultySignatureName || '-' }} <span class="text-muted">— {{ agrs[agrs.length-1].facultySignedAt | date:'short' }}</span></div>
                <div>Office: {{ agrs[agrs.length-1].officeSignatureName || '-' }} <span class="text-muted">— {{ agrs[agrs.length-1].officeSignedAt | date:'short' }}</span></div>
              </div>
            } @else {
              <div class="text-muted small">No agreement submitted.</div>
            }
          }

          <h6 class="mt-3">Design Statement</h6>
          @if (designStatementsOf(sid); as dss) {
            @if (dss.length) {
              <div class="small">
                <details>
                  <summary>
                    <strong>Organization:</strong> {{ dss[dss.length-1].placement.organization }} ({{ dss[dss.length-1].placement.mode }})
                    <span class="text-muted">· Functional Area: {{ dss[dss.length-1].placement.functionalArea }}</span>
                  </summary>
                  <div class="mt-2">
                    <div class="fw-semibold">Career Goal</div>
                    <div class="mb-2">{{ dss[dss.length-1].careerGoal }}</div>
                    <div class="fw-semibold">Learning Objectives</div>
                    <div class="mb-2">{{ dss[dss.length-1].learningObjectives }}</div>
                    <div class="fw-semibold">Placement Overview</div>
                    <div class="mb-2">{{ dss[dss.length-1].placement.overview || '-' }}</div>
                    <div class="fw-semibold">Supervisor</div>
                    <div class="mb-2">{{ dss[dss.length-1].supervisor.name }} — {{ dss[dss.length-1].supervisor.designation }} ({{ dss[dss.length-1].supervisor.email }} · {{ dss[dss.length-1].supervisor.contact }})</div>
                    <div class="fw-semibold">Scope & Deliverables</div>
                    <div class="mb-2">{{ dss[dss.length-1].scopeAndDeliverables }}</div>
                    <div class="fw-semibold">Academic Preparation</div>
                    <div class="mb-2">{{ dss[dss.length-1].academicPreparation }}</div>
                    <div class="fw-semibold">Comments</div>
                    <div class="mb-1">{{ dss[dss.length-1].comments || '-' }}</div>
                  </div>
                </details>
              </div>
            } @else {
              <div class="text-muted small">No design statement.</div>
            }
          }
        </div>

        <div class="col-12 col-lg-6">
          <h6>Reports</h6>
          <ul class="list-group mb-3">
            @for (r of reportsOf(sid); track $index) {
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>{{ r.type | titlecase }} — {{ r.title || '(Untitled)' }} <span class="text-muted">· {{ r.date | date:'short' }}</span></span>
              @if (r.score != null) {<span class="badge text-bg-secondary">Score: {{ r.score }}</span>}
            </li>
            }
          </ul>
          <h6>Weekly Logs</h6>
          <ul class="list-group mb-3">
            @for (l of logsOf(sid); track $index) {
            <li class="list-group-item">Week {{ l.week }} · {{ l.note }} <span class="text-muted">— {{ l.date | date:'short' }}</span></li>
            }
          </ul>
          <h6>Assignments</h6>
          <ul class="list-group mb-3">
            @for (a of assignmentsOf(sid); track $index) {
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>{{ a.fileName }} <span class="text-muted">· {{ a.uploadedAt | date:'short' }}</span></span>
              <button class="btn btn-sm btn-outline-primary" (click)="downloadAssignment(a)">Download</button>
            </li>
            }
          </ul>
          <h6>Freelance / Mode</h6>
          <ul class="list-group">
            @for (f of freelanceOf(sid); track $index) {
            <li class="list-group-item"><strong>{{ f.platform }}</strong> <span class="text-muted">— {{ f.createdAt | date:'short' }}</span></li>
            }
          </ul>
        </div>
      </div>
    </div>
  </div>
  } }

  <div class="row g-3 mt-4" *ngIf="currentTab==='applications'">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-light">Applications (Approval Forms)</div>
        <div class="card-body">
          <div class="form-check form-switch mb-2">
            <input class="form-check-input" type="checkbox" id="pendOnly" [(ngModel)]="showPendingOnly">
            <label class="form-check-label" for="pendOnly">Show only pending</label>
          </div>
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr><th>Student</th><th>Submitted</th><th>Status</th><th>Officer Comment</th><th>Actions</th></tr>
              </thead>
              <tbody>
                @for (s of students(); track s.id) {
                <tr [hidden]="!showInApplications(s.id)">
                  <td>
                    <div><strong>{{ s.name }}</strong> <span class="text-muted small">({{ s.email }})</span></div>
                    @if (latestApproval(s.id); as a) {
                    <div class="small text-muted">v{{ a.version }} — Company: {{ a.company.name || '-' }} — {{ a.internship.startDate }} → {{ a.internship.endDate }}</div>
                    }
                  </td>
                  <td>{{ latestApproval(s.id)?.createdAt | date:'short' }}</td>
                  <td>
                    <span class="badge"
                      [class.text-bg-secondary]="!latestApproval(s.id)?.status || latestApproval(s.id)?.status==='pending'"
                      [class.text-bg-success]="latestApproval(s.id)?.status==='approved'"
                      [class.text-bg-danger]="latestApproval(s.id)?.status==='rejected'">
                      {{ latestApproval(s.id)?.status || 'pending' }}
                    </span>
                    @if (latestApproval(s.id)?.resolvedAt) {
                    <div class="small text-muted">{{ latestApproval(s.id)?.resolvedAt | date:'short' }}</div>
                    }
                  </td>
                  <td class="w-25">
                    <input class="form-control form-control-sm" placeholder="Comment (optional)" [(ngModel)]="approvalComment[s.id]" name="ac{{s.id}}" />
                  </td>
                  <td>
                    <div class="d-flex gap-2">
                      <select class="form-select form-select-sm" style="width:140px" [(ngModel)]="approvalDecision[s.id]" name="ad{{s.id}}">
                        <option [ngValue]="''">Choose…</option>
                        <option [ngValue]="'approved'">Approve</option>
                        <option [ngValue]="'rejected'">Reject</option>
                      </select>
                      <button class="btn btn-sm btn-outline-primary" (click)="reviewApproval(s.id)">Apply</button>
                    </div>
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3 mt-3" *ngIf="currentTab==='scheme'">
    <div class="col-12">
      <div class="alert alert-info">
        <div class="fw-semibold">Evaluation Scheme</div>
        <ul class="mb-0">
          <li><strong>On-site / Virtual:</strong> Site Supervisor (40) + Faculty Supervisor (40) + Internship Office (20). Office sub-breakdown: Proposal 5, Weekly Logs 5, Final Report 10.</li>
          <li><strong>Freelancing (Fiverr/Upwork):</strong> Supervisor (60) + Internship Office (40). Office sub-breakdown still 5+5+10 but auto-scales to 40.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="row g-3 mt-4" *ngIf="currentTab==='compliance'">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-light">Internship Evaluation Committee (20% Weightage)</div>
        <div class="card-body">
          <p class="mb-2"><strong>Composition:</strong> Notified by the HoD under the convenorship of the In-charge Internship Office with other members as deemed fit.</p>
          <p class="mb-2"><strong>Role:</strong> Evaluate internship report, weekly logs, and technical contribution.</p>
          <p class="mb-0"><strong>Grading:</strong> Assigns 20% of total marks (15% Report Submission, 5% Weekly Log) and submits results to the Internship Office for final processing.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3 mt-4" *ngIf="currentTab==='students'">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-light">Weekly Log Compliance</div>
        <div class="card-body">
          <p class="text-muted">Tracks expected vs submitted weekly logs based on the Approval start date.</p>
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr><th>Student</th><th>Start</th><th>Expected Weeks</th><th>Submitted</th><th>Status</th></tr>
              </thead>
              <tbody>
                @for (s of students(); track s.id) {
                <tr>
                  <td>{{ s.name }} <span class="text-muted small">({{ s.email }})</span></td>
                  <td>{{ startDateString(s.id) }}</td>
                  <td>{{ expectedWeeks(s.id) }}</td>
                  <td>{{ logsCount(s.id) }}</td>
                  <td>
                    <span class="badge" [class.text-bg-success]="hasLogThisWeek(s.id)" [class.text-bg-danger]="!hasLogThisWeek(s.id)">
                      {{ hasLogThisWeek(s.id) ? 'This week submitted' : 'Missing this week' }}
                    </span>
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Complaints tab: list student complaints and allow resolution -->
  <div class="row g-3 mt-4" *ngIf="currentTab==='complaints'">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-light">Complaints & Grievances</div>
        <div class="card-body">
          <p class="text-muted">Respond to student complaints submitted to the Internship Office.</p>
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead><tr><th>Date</th><th>Student</th><th>Category</th><th>Message</th><th>Status</th><th>Response</th><th>Action</th></tr></thead>
              <tbody>
                @for (c of complaints(); track c.id) {
                <tr>
                  <td>{{ c.createdAt | date:'short' }}</td>
                  <td>{{ studentName(c.studentId) }}</td>
                  <td>{{ c.category }}</td>
                  <td style="max-width:280px">{{ c.message }}</td>
                  <td>
                    <span class="badge" [class.text-bg-secondary]="c.status==='open'" [class.text-bg-success]="c.status==='resolved'">{{ c.status }}</span>
                  </td>
                  <td style="max-width:260px">{{ c.response || '-' }}</td>
                  <td>
                    @if (c.status==='open') {
                      <div class="input-group input-group-sm">
                        <input class="form-control" placeholder="Type response..." [(ngModel)]="responses[c.id]" name="resp{{c.id}}" />
                        <button class="btn btn-outline-success" (click)="resolve(c.id)">Resolve</button>
                      </div>
                    }
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Requests tab: faculty-submitted requests for companies or site supervisors -->
  <div class="row g-3 mt-4" *ngIf="currentTab==='requests'">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-light">Requests from Faculty</div>
        <div class="card-body">
          <p class="text-muted">Review requests to add Companies or Site Supervisors submitted by faculty supervisors.</p>
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>When</th>
                  <th>Type</th>
                  <th>Details</th>
                  <th>Requested By</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                @for (r of requests(); track r.id) {
                <tr>
                  <td>{{ r.createdAt | date:'short' }}</td>
                  <td>
                    <span class="badge" [class.text-bg-primary]="r.type==='company'" [class.text-bg-info]="r.type==='site'">{{ r.type | titlecase }}</span>
                  </td>
                  <td>
                    @if (r.type==='company') {
                      <div><strong>{{ r.name }}</strong></div>
                      <div class="text-muted small">{{ r.address || '-' }}</div>
                    } @else {
                      <div><strong>{{ requestPrimary(r) }}</strong></div>
                      <div class="text-muted small">{{ requestSecondary(r) }}</div>
                    }
                  </td>
                  <td>{{ facultyName(r.requestedByFacultyId) }}</td>
                  <td>
                    <span class="badge"
                      [class.text-bg-secondary]="r.status==='pending'"
                      [class.text-bg-success]="r.status==='approved'"
                      [class.text-bg-danger]="r.status==='rejected'">
                      {{ r.status }}
                    </span>
                    @if (r.resolvedAt) {
                    <div class="small text-muted">{{ r.resolvedAt | date:'short' }}</div>
                    }
                  </td>
                  <td>
                    @if (r.status==='pending') {
                      <div class="d-flex gap-2">
                        <button class="btn btn-sm btn-outline-success" (click)="approveRequest(r.id)">Approve</button>
                        <button class="btn btn-sm btn-outline-danger" (click)="rejectRequest(r.id)">Reject</button>
                      </div>
                    } @else {
                      <div class="small text-muted">—</div>
                    }
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Announcements tab: create and manage announcements -->
  <div class="row g-3 mt-4" *ngIf="currentTab==='announcements'">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-light">Announcements</div>
        <div class="card-body">
          <div class="row g-2 align-items-end">
            <div class="col-md-3">
              <label class="form-label">Title (optional)</label>
              <input class="form-control" [(ngModel)]="announcement.title" name="atitle" />
            </div>
            <div class="col-md-5">
              <label class="form-label">Message</label>
              <input class="form-control" [(ngModel)]="announcement.message" name="amsg" placeholder="e.g., Weekly log window extended till Friday" />
            </div>
            <div class="col-md-3">
              <label class="form-label">Link (optional)</label>
              <input class="form-control" [(ngModel)]="announcement.link" name="alink" placeholder="https://..." />
            </div>
            <div class="col-md-1">
              <div class="form-check mt-4">
                <input class="form-check-input" type="checkbox" [(ngModel)]="announcement.pinned" name="apinned" id="apinned">
                <label class="form-check-label" for="apinned">Pin</label>
              </div>
            </div>
            <div class="col-12 col-md-2 mt-2 mt-md-0">
              <button class="btn btn-primary w-100" (click)="addAnnouncement()">Publish</button>
            </div>
          </div>

          @if (announcements(); as anns) {
            <div class="table-responsive mt-3">
              <table class="table table-sm align-middle">
                <thead><tr><th>When</th><th>Title</th><th>Message</th><th>Link</th><th>Pinned</th><th>Actions</th></tr></thead>
                <tbody>
                  @for (a of anns; track a.id) {
                  <tr>
                    <td class="small text-muted">{{ a.createdAt | date:'short' }}</td>
                    <td>{{ a.title || '-' }}</td>
                    <td style="max-width:420px">{{ a.message }}</td>
                    <td>
                      @if (a.link) { <a [href]="a.link" target="_blank" rel="noopener">Open</a> } @else { <span class="text-muted">—</span> }
                    </td>
                    <td>
                      <span class="badge" [class.text-bg-primary]="a.pinned" [class.text-bg-secondary]="!a.pinned">{{ a.pinned ? 'Yes' : 'No' }}</span>
                    </td>
                    <td>
                      <div class="d-flex gap-2">
                        <button class="btn btn-sm btn-outline-secondary" (click)="togglePinned(a.id)">{{ a.pinned ? 'Unpin' : 'Pin' }}</button>
                        <button class="btn btn-sm btn-outline-danger" (click)="removeAnnouncement(a.id)">Remove</button>
                      </div>
                    </td>
                  </tr>
                  }
                </tbody>
              </table>
            </div>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Removed duplicate global Announcements block; announcements now live under the Announcements tab only -->

  <hr class="my-4" *ngIf="currentTab==='officers'"/>
  <h3 class="mb-3" *ngIf="currentTab==='officers'">Internship Officers</h3>
  <div class="row g-3 align-items-end">
    <div class="col-md-4">
      <label class="form-label">Name</label>
      <input class="form-control" [(ngModel)]="officer.name" name="oname" />
    </div>
    <div class="col-md-4">
      <label class="form-label">Email</label>
      <input type="email" class="form-control" [(ngModel)]="officer.email" name="oemail" />
    </div>
    <div class="col-md-4">
      <button class="btn btn-primary" (click)="addOfficer()">Add Officer</button>
    </div>
  </div>
  <ul class="list-group mt-3" *ngIf="currentTab==='officers'">
    @for (o of officers(); track o.email) {
    <li class="list-group-item d-flex justify-content-between align-items-center">{{ o.name }} <span class="text-muted">{{ o.email }}</span></li>
    }
  </ul>
  <div class="row g-3 align-items-end mt-4" *ngIf="currentTab==='officers'">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-light">Add Internship Officer </div>
        <div class="card-body">
          <div class="row g-3 align-items-end">
            <div class="col-md-4">
              <label class="form-label">Name</label>
              <input class="form-control" [(ngModel)]="adminAccount.name" name="aname" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" [(ngModel)]="adminAccount.email" name="aemail" />
            </div>
            <div class="col-md-3">
              <label class="form-label">Password</label>
              <input type="password" class="form-control" [(ngModel)]="adminAccount.password" name="apass" />
            </div>
            <div class="col-md-1 d-grid">
              <button class="btn btn-outline-primary" [disabled]="creatingAdmin" (click)="createAdminAccount()">
                {{ creatingAdmin ? 'Adding…' : 'Add' }}
              </button>
            </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>

  <hr class="my-4" *ngIf="currentTab==='faculty'"/>
  <h3 class="mb-3" *ngIf="currentTab==='faculty'">Faculty Supervisors</h3>
  <div class="row g-3 align-items-end">
    <div class="col-md-4">
      <label class="form-label">Name</label>
      <input class="form-control" [(ngModel)]="faculty.name" name="fname" />
    </div>
    <div class="col-md-4">
      <label class="form-label">Email</label>
      <input type="email" class="form-control" [(ngModel)]="faculty.email" name="femail" />
    </div>
    <div class="col-md-3">
      <label class="form-label">Department</label>
      <input class="form-control" [(ngModel)]="faculty.department" name="fdept" />
    </div>
    <div class="col-md-3">
      <label class="form-label">Password</label>
      <input type="password" class="form-control" [(ngModel)]="faculty.password" name="fpass" />
    </div>
    <div class="col-md-1 d-grid">
      <button class="btn btn-primary" (click)="addFaculty()">Add</button>
    </div>
  </div>
  <ul class="list-group mt-3" *ngIf="currentTab==='faculty'">
    @for (f of facultyList(); track f.id) {
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div class="me-2">
        <div>{{ f.name }} — <span class="text-muted">{{ f.email }}</span></div>
        <div class="small text-muted">Password: {{ f.password ? 'set' : 'not set' }}</div>
      </div>
      <div class="d-flex gap-2 align-items-center">
        <input class="form-control form-control-sm" style="width:160px" placeholder="New password" [(ngModel)]="facultyNewPw[f.id]" name="fpw{{f.id}}" />
        <button class="btn btn-sm btn-outline-secondary" (click)="setFacultyPassword(f.id)">Set Password</button>
        <button class="btn btn-sm btn-outline-danger" (click)="removeFaculty(f.id)">Remove</button>
      </div>
    </li>
    }
  </ul>

  <hr class="my-4" *ngIf="currentTab==='companies'"/>
  <h3 class="mb-3" *ngIf="currentTab==='companies'">Companies & Site Supervisors</h3>
  <div class="row g-3 align-items-end">
    <div class="col-md-5">
      <label class="form-label">Company Name</label>
      <input class="form-control" [(ngModel)]="company.name" name="cname2" />
    </div>
    <div class="col-md-5">
      <label class="form-label">Address</label>
      <input class="form-control" [(ngModel)]="company.address" name="caddr2" />
    </div>
    <div class="col-md-2">
      <button class="btn btn-primary w-100" (click)="addCompany()">Add Company</button>
    </div>
  </div>
  <div class="row g-3 align-items-end mt-2">
    <div class="col-md-3">
      <label class="form-label">Site Supervisor</label>
      <input class="form-control" [(ngModel)]="site.name" name="sname2" />
    </div>
    <div class="col-md-3">
      <label class="form-label">Email</label>
      <input type="email" class="form-control" [(ngModel)]="site.email" name="semail2" />
    </div>
    <div class="col-md-4">
      <label class="form-label">Company</label>
      <select class="form-select" [(ngModel)]="site.companyId" name="scid2">
        <option [ngValue]="''">Select company...</option>
        @for (c of companyList(); track c.id) {
        <option [ngValue]="c.id">{{ c.name }}</option>
        }
      </select>
    </div>
    <div class="col-md-2">
      <label class="form-label">Password</label>
      <input type="password" class="form-control" [(ngModel)]="site.password" name="spass2" />
    </div>
    <div class="col-md-2 d-grid">
      <button class="btn btn-primary" (click)="addSite()">Add Site</button>
    </div>
  </div>
  <div class="table-responsive mt-3" *ngIf="currentTab==='companies'">
    <table class="table table-sm">
      <thead><tr><th>Company</th><th>Site Supervisor</th><th>Email</th><th>Password</th><th>Actions</th></tr></thead>
      <tbody>
        @for (t of siteList(); track t.id) {
        <tr>
          <td>{{ companyName(t.companyId) }}</td>
          <td>{{ t.name }}</td>
          <td>{{ t.email }}</td>
          <td class="text-muted small">{{ t.password ? 'set' : 'not set' }}</td>
          <td>
            <div class="d-flex gap-2 align-items-center">
              <input class="form-control form-control-sm" style="width:160px" placeholder="New password" [(ngModel)]="siteNewPw[t.id]" name="spw{{t.id}}" />
              <button class="btn btn-sm btn-outline-secondary" (click)="setSitePassword(t.id)">Set Password</button>
              <button class="btn btn-sm btn-outline-danger" (click)="removeSite(t.id)">Remove</button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  <div class="table-responsive mt-3" *ngIf="currentTab==='companies'">
    <table class="table table-sm">
      <thead><tr><th>Company</th><th>Address</th><th>Actions</th></tr></thead>
      <tbody>
        @for (c of companyList(); track c.id) {
        <tr>
          <td>{{ c.name }}</td>
          <td>{{ c.address || '-' }}</td>
          <td><button class="btn btn-sm btn-outline-danger" (click)="removeCompany(c.id)">Remove</button></td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>
